# QEMU VM Manager for Automated Ubuntu Desktop Setup

## 1. Introduction

This project provides a suite of scripts to automate the creation, configuration, and management of multiple unique QEMU/KVM virtual machines (VMs). Each VM is set up with Ubuntu Desktop (minimal), unique hardware identifiers, resource limits, VNC access for graphical interface, an OpenVPN client configured with a unique profile, and Telegram Desktop pre-installed.

The primary goal is to simplify the process of deploying numerous distinctly fingerprinted VMs for various testing, development, or operational scenarios.

## 2. Features

*   **Automated VM Creation**: Scripts handle the entire lifecycle from disk image creation to guest OS setup.
*   **Unique VM Identities**:
    *   Each VM receives a unique MAC address.
    *   Each VM is assigned a unique UUID.
    *   Each VM gets a unique BIOS serial number.
    *   CPU model presented to the guest is varied across VMs from a predefined list.
    *   RAM allocation is primarily 2GB, with minor variations for some VMs to enhance fingerprint diversity.
*   **Configuration Driven**:
    *   VM specifications (name, MAC, VNC port/password, UUID, BIOS serial, CPU model, RAM, OpenVPN profile) are generated by a Python script and stored in individual JSON files (`vm_configs/vm-X.json`).
    *   Default creation of 10 VMs, easily configurable.
*   **Automated Ubuntu Installation**:
    *   Uses a preseed configuration file (`scripts/preseed.cfg`) for unattended Ubuntu Desktop (minimal) installation.
    *   Creates a default user `vmuser` with password `userpass`.
*   **In-Guest Setup**: A post-installation script (`scripts/setup_vm_in_guest.sh`) handles:
    *   **VNC Server**: Installs and configures `x11vnc` to start automatically with the user's desktop session, secured by a unique password for each VM.
    *   **OpenVPN Client**: Configures and enables the OpenVPN client service to connect automatically using a unique `.ovpn` profile (from `vpn/vpn-X.ovpn`) for each VM. Includes connection verification via ping.
    *   **Telegram Desktop**: Downloads and installs the latest official portable version of Telegram Desktop.
*   **Resource Management**:
    *   **CPU**: Each VM's QEMU process is limited to approximately 80% of a single CPU core's capacity using the `cpulimit` utility.
    *   **RAM**: Each VM is allocated 2GB of RAM by default (with some minor variations).
*   **Access and Logging**:
    *   VMs are accessible via VNC on sequentially assigned host ports (5900, 5901, ...).
    *   Comprehensive logging:
        *   Main script (`manage_vms.sh`) logs to console.
        *   Preseed `late_command` logs to `/target/var/log/late_command.log` during installation.
        *   Guest setup script (`setup_vm_in_guest.sh`) logs to `/var/log/setup_vm_in_guest.log` inside the VM.
        *   `x11vnc` logs to `/home/vmuser/x11vnc.log` inside the VM.
    *   Summary of created VM details (MAC, VNC port/password, UUID, BIOS serial) is saved to `output/vm_info.txt`.

## 3. How it Works

The system is orchestrated by the main `manage_vms.sh` script. Here's a breakdown of the process:

1.  **Initialization (`manage_vms.sh`)**:
    *   Sets up project directory paths.
    *   Performs **Dependency Checks**: Verifies that essential host tools (`qemu-system-x86_64`, `qemu-img`, `python3`, `jq`, `cpulimit`) are installed.
    *   Performs **Project File Checks**: Ensures the user has provided the Ubuntu Desktop ISO (`iso/ubuntu-desktop.iso`) and all required OpenVPN configuration files (`vpn/vpn-X.ovpn`).

2.  **VM Configuration Generation (`manage_vms.sh` calls `scripts/generate_vm_configs.py`)**:
    *   The Python script `scripts/generate_vm_configs.py` is executed.
    *   It creates (or overwrites) JSON configuration files (e.g., `vm_configs/vm-1.json`, `vm_configs/vm-2.json`, ...) for the specified number of VMs (default 10).
    *   Each JSON file contains all unique parameters for a single VM: `vm_id`, `vm_name`, `mac_address`, `vnc_port_host`, `vnc_password`, `uuid`, `bios_serial`, `cpu_model`, `ram_size_mb`, `disk_size_gb`, and `openvpn_config_file`.

3.  **Per-VM Processing Loop (`manage_vms.sh`)**: The script iterates through each generated VM configuration. For each VM:

    a.  **Disk Image Creation**:
        *   If a disk image (`vm_disks/VM_NAME.qcow2`) for the current VM does not already exist, `qemu-img create` is used to create a new QCOW2 disk image of the specified size.
        *   If it exists, the installation phase is skipped.

    b.  **Temporary HTTP Server Setup (for Installation Phase only)**:
        *   A temporary directory (e.g., `/tmp/qemu_http_serve/vm-1-serve`) is created.
        *   The following files are copied/created in this directory:
            *   `vm-X-params.sh`: A small shell script generated on-the-fly, containing VM-specific parameters (HOST_IP for guest, HTTP port, VM_ID, VNC password, OpenVPN config filename) that the guest will need during setup.
            *   `scripts/setup_vm_in_guest.sh`: The main guest OS configuration script.
            *   `scripts/preseed.cfg`: The Ubuntu preseed file.
            *   `vpn/vpn-X.ovpn`: The specific OpenVPN configuration file for this VM.
        *   A Python `http.server` is started in this temporary directory on a unique port for each VM's installation (e.g., 8000, 8001,...).

    c.  **QEMU VM Installation**:
        *   `qemu-system-x86_64` is launched with:
            *   The path to the Ubuntu Desktop ISO (`iso/ubuntu-desktop.iso`) as a CD-ROM.
            *   The newly created disk image (`vm_disks/VM_NAME.qcow2`).
            *   Hardware parameters from the JSON config (RAM, CPU model, MAC, UUID, BIOS serial).
            *   VNC enabled on the host port specified in the JSON config (e.g., `localhost:5900`).
            *   Kernel append line parameters for automated installation:
                *   `preseed/url=http://<HOST_IP_FOR_GUEST>:<HTTP_PORT>/preseed.cfg`: Tells the installer to fetch the preseed file from the temporary HTTP server.
                *   `vm_setup_params_url=http://<HOST_IP_FOR_GUEST>:<HTTP_PORT>/vm-X-params.sh`: Passes the URL of the VM-specific parameters script to the installer environment.
        *   The `preseed.cfg` file automates the entire Ubuntu installation process.
        *   **`preseed.cfg` Late Command**: Towards the end of the preseed installation, a `late_command` is executed within the newly installed system (chrooted environment). This command:
            1.  Fetches `vm-X-params.sh` from the temporary HTTP server using the URL passed on the kernel command line.
            2.  Sources `vm-X-params.sh` to load VM-specific variables (VNC password, OpenVPN config name, etc.) into its environment.
            3.  Fetches the main `scripts/setup_vm_in_guest.sh` from the temporary HTTP server.
            4.  Executes `setup_vm_in_guest.sh`, passing the VM-specific variables (now suffixed with `_FOR_GUEST`) as environment variables to it.
            5.  The exit status of `setup_vm_in_guest.sh` determines the success/failure of the `late_command`.
        *   The preseed configuration is set to **halt** the VM upon completion of the installation.
        *   `manage_vms.sh` waits for the QEMU installation process to exit and checks its exit code. A non-zero exit code indicates a failure during installation or the `late_command`/`setup_vm_in_guest.sh` execution.

    d.  **HTTP Server Teardown**: The temporary HTTP server and its directory are stopped and removed.

    e.  **Normal VM Boot**:
        *   QEMU is launched again, this time booting from the VM's disk image (`-boot c`).
        *   It uses the same hardware parameters (RAM, CPU, MAC, UUID, VNC port, etc.) as during installation.
        *   The VM is started in daemonized (background) mode using `-daemonize`.
        *   A PID file is created for the QEMU process.

    f.  **CPU Limiting**:
        *   `manage_vms.sh` reads the PID from the PID file.
        *   `cpulimit` is used to attach to this QEMU process and limit its CPU usage to 80% of a single core. `cpulimit` itself is run in the background.

    g.  **Logging Information**:
        *   The VM's name, MAC address, host VNC port, VNC password (for in-guest `x11vnc`), UUID, and BIOS serial number are appended to `output/vm_info.txt`.

4.  **In-Guest Operations (`scripts/setup_vm_in_guest.sh`)**: This script, running inside the VM via the preseed `late_command`, performs:
    *   **VNC Server Setup**:
        *   Sets the VNC password (passed from `vm-X-params.sh`) using `x11vnc -storepasswd`.
        *   Creates an XDG autostart file (`/etc/xdg/autostart/x11vnc_autostart.desktop`) to launch `x11vnc` automatically when `vmuser`'s desktop session starts. This provides VNC access to the graphical desktop on port 5900 *inside the VM*, which is then forwarded by QEMU to the unique host port.
    *   **OpenVPN Client Setup**:
        *   Fetches the VM-specific `.ovpn` file (e.g., `vpn-1.ovpn`) from the host's temporary HTTP server (details passed via `vm-X-params.sh`).
        *   Places it as `/etc/openvpn/client/client.conf`.
        *   Enables and starts the `openvpn-client@client.service` systemd service.
        *   Performs a connection check by pinging an external IP address. If this fails, the script exits with an error, signaling failure to the preseed process.
    *   **Telegram Desktop Installation**:
        *   Downloads the official Linux portable version of Telegram.
        *   Extracts it to `/opt/telegram`.
        *   Creates a symlink (`/usr/local/bin/telegram-desktop`) and a `.desktop` file for application menu integration.
    *   **Completion Flag**: Creates `/home/vmuser/vm_setup_complete.flag`.

## 4. Prerequisites

### 4.1. Host System Software

Ensure the following software is installed on your Linux host system (examples for Ubuntu):

*   **QEMU/KVM**: Full virtualization capabilities.
    ```bash
    sudo apt update
    sudo apt install qemu-system-x86 qemu-utils libvirt-daemon-system libvirt-clients bridge-utils virt-manager
    # Add your user to the libvirt and kvm groups to manage VMs without sudo for QEMU
    sudo adduser $(whoami) libvirt
    sudo adduser $(whoami) kvm
    # Log out and log back in for group changes to take effect.
    ```
*   **Python 3 & PIP**: For the VM configuration generation script.
    ```bash
    sudo apt install python3 python3-pip
    ```
*   **jq**: Command-line JSON processor used by `manage_vms.sh`.
    ```bash
    sudo apt install jq
    ```
*   **cpulimit**: Utility to limit process CPU usage.
    ```bash
    sudo apt install cpulimit
    ```
*   **wget**: For downloading files within guest setup scripts (usually pre-installed).
    ```bash
    sudo apt install wget
    ```
*   **mkpasswd** (Optional, for reference): Used to generate password hashes if you modify the preseed user password. Often part of the `whois` package.
    ```bash
    sudo apt install whois
    # or sudo apt install mkpasswd
    ```

### 4.2. User-Provided Files

1.  **Ubuntu Desktop ISO**:
    *   Download a recent Ubuntu Desktop ISO image (e.g., Ubuntu 22.04 LTS or 24.04 LTS Desktop AMD64). The scripts are generally tested with LTS versions.
    *   Place the ISO file in the `qemu_vm_manager/iso/` directory.
    *   **Rename it to `ubuntu-desktop.iso`**.
        ```bash
        # Example:
        # mkdir -p qemu_vm_manager/iso
        # mv ~/Downloads/ubuntu-22.04.4-desktop-amd64.iso qemu_vm_manager/iso/ubuntu-desktop.iso
        ```

2.  **OpenVPN Configuration Files**:
    *   You need OpenVPN configuration files (`.ovpn`) for each VM you intend to create (default is 10).
    *   Name them sequentially: `vpn-1.ovpn`, `vpn-2.ovpn`, ..., `vpn-10.ovpn`.
    *   Place these files into the `qemu_vm_manager/vpn/` directory.
        ```bash
        # Example:
        # mkdir -p qemu_vm_manager/vpn
        # cp /path/to/your/config_for_vm1.ovpn qemu_vm_manager/vpn/vpn-1.ovpn
        # cp /path/to/your/config_for_vm2.ovpn qemu_vm_manager/vpn/vpn-2.ovpn
        # ... and so on.
        ```
    *   **Note on `auth-user-pass`**: The current `setup_vm_in_guest.sh` script assumes OpenVPN configurations do not require interactive username/password entry or an `auth-user-pass` file. If your `.ovpn` files need this, you'll need to modify `setup_vm_in_guest.sh` to handle credential provisioning.

## 5. Project Setup

1.  **Obtain Project Files**:
    *   If cloned from Git: `git clone <repository_url> qemu_vm_manager`
    *   If downloaded as a ZIP: Extract the files to a directory named `qemu_vm_manager`.

2.  **Navigate to Project Directory**:
    ```bash
    cd qemu_vm_manager
    ```

3.  **Create Necessary Subdirectories (if not present)**:
    The main script will attempt to create `vm_configs`, `vm_disks`, and `output`, but `iso` and `vpn` must be created by you if they don't exist from the download.
    ```bash
    mkdir -p iso vpn vm_configs vm_disks scripts output
    ```

4.  **Populate `iso/` and `vpn/` directories** as described in section 4.2.

5.  **Make Scripts Executable**:
    ```bash
    chmod +x manage_vms.sh
    chmod +x scripts/generate_vm_configs.py
    # setup_vm_in_guest.sh is made executable by preseed's late_command
    ```

## 6. Running the System

To start the VM creation and setup process, execute the main management script from *within* the `qemu_vm_manager` directory:

```bash
./manage_vms.sh
```

**Important Considerations During Execution**:

*   **Execution Time**: Creating and installing multiple VMs is a lengthy process. For 10 VMs, this could take several hours, depending on your host system's performance (CPU, disk I/O) and internet connection speed. It's highly recommended to test with `NUM_VMS=1` first (see Customization section).
*   **Resource Consumption**:
    *   **Disk Space**: Each VM disk image is configured to 20GB. For 10 VMs, this means at least 200GB of free disk space is needed, plus space for the ISO and temporary files.
    *   **RAM**: Each VM uses ~2GB of RAM. Running 10 VMs simultaneously will require substantial host RAM (>20GB).
    *   **CPU**: While `cpulimit` restricts individual VMs, running many QEMU processes is CPU intensive.
*   **Internet Connection**: A stable internet connection is required by the VMs during installation (for package downloads) and by `setup_vm_in_guest.sh` (for Telegram download).
*   **Permissions (`cpulimit`)**: The `cpulimit` command might require `sudo` privileges to attach to QEMU processes, especially if QEMU is run by a different user (e.g., `libvirt-qemu` if KVM is managed by libvirt in some setups, though this script runs QEMU directly as the current user). If `cpulimit` fails, a warning will be logged, and CPU limiting will not be active for that VM. You might need to run `sudo ./manage_vms.sh` if you encounter permission issues with `cpulimit`. *Always be cautious when running complex scripts with sudo.*

## 7. Expected Output

*   **VM Disk Images**: QCOW2 files (e.g., `ubuntu-vm-1.qcow2`) located in `qemu_vm_manager/vm_disks/`.
*   **VM Configuration Files**: JSON files (e.g., `vm-1.json`) detailing each VM's specifications, located in `qemu_vm_manager/vm_configs/`.
*   **VM Information Summary**: A text file `qemu_vm_manager/output/vm_info.txt` containing a comma-separated list of:
    `VM_Name,MAC_Address,VNC_Port_Host,VNC_Password,UUID,BIOS_Serial`
*   **Running QEMU Processes**: Each successfully created VM will have a corresponding `qemu-system-x86_64` process running in the background (daemonized). You can list them using `ps aux | grep qemu-system-x86_64`.
*   **Console Logs**: The `manage_vms.sh` script will print detailed logs to the console during its operation. It's recommended to redirect this to a file for later review:
    ```bash
    ./manage_vms.sh > management_run.log 2>&1
    ```

## 8. Accessing the VMs

*   **VNC (Virtual Network Computing)**: Each VM's graphical desktop is accessible via a VNC client (e.g., TigerVNC, Remmina, RealVNC Viewer).
    *   Connect to `localhost:<VNC_Port_Host>`.
    *   The `VNC_Port_Host` for each VM is listed in `output/vm_info.txt` and typically starts from 5900 for VM 1 (e.g., `localhost:5900`), 5901 for VM 2, and so on.
*   **VNC Password**: The unique VNC password for the `x11vnc` server running *inside* each VM is also listed in `output/vm_info.txt`.
*   **In-VM User Credentials**:
    *   Username: `vmuser`
    *   Password: `userpass`
    (These are set in `scripts/preseed.cfg`).

## 9. Error Handling and Debugging

The scripts incorporate error checking (`set -eo pipefail` in shell scripts, explicit checks in `manage_vms.sh`).

*   **`manage_vms.sh` Console Output**: This is your primary source for observing the script's progress and any errors from the host side. Redirect to a file for detailed review.
*   **QEMU Installation Phase**:
    *   If an installation hangs or fails, connect to the VM's installation VNC port (`localhost:590X`).
    *   Inside the installer's VNC session, press `Alt+F4` to view verbose installer logs (especially if `DEBCONF_DEBUG=5` is active, which it is by default).
    *   If the installation completes but the `late_command` (which runs `setup_vm_in_guest.sh`) fails, this should cause QEMU to exit with an error. The `manage_vms.sh` script will log this.
    *   The preseed `late_command` itself logs to `/target/var/log/late_command.log` *within the context of the installing system*. If the installation fails catastrophically, you might need to mount the VM's disk image (`.qcow2` file) to access this log.
*   **`setup_vm_in_guest.sh` Log (Inside Guest VM)**:
    *   Once a VM is running, this script's actions are logged to `/var/log/setup_vm_in_guest.log` *inside the VM*. SSH into the VM or use the VNC desktop terminal to view it.
*   **`x11vnc` Log (Inside Guest VM)**:
    *   The `x11vnc` server logs to `/home/vmuser/x11vnc.log` *inside the VM*. Check this if you have VNC connection issues after the VM is supposedly set up.
*   **OpenVPN Client (Inside Guest VM)**:
    *   Check service status: `sudo systemctl status openvpn-client@client.service`
    *   View logs: `sudo journalctl -u openvpn-client@client.service -n 50 --no-pager`
    *   The `setup_vm_in_guest.sh` script performs a ping test after starting OpenVPN. Its log will show the result.
    *   If OpenVPN connects but there's no internet, check DNS settings (may need to be pushed by VPN server or set manually) and routing (`ip route show`).
*   **Common Issues**:
    *   **Missing Dependencies/Files**: `manage_vms.sh` should report these early.
    *   **Permissions**: `cpulimit` might need `sudo`. QEMU might need user in `kvm` group.
    *   **ISO/Preseed Incompatibility**: If using a very different Ubuntu version, `preseed.cfg` might need adjustments.
    *   **Network Issues**: Host or guest network problems can prevent downloading files or OpenVPN connection.
    *   **Resource Exhaustion**: Insufficient host RAM/disk/CPU.

## 10. Fingerprinting Techniques Used

To ensure each VM appears distinct, several parameters are varied:

*   **MAC Address**: Each VM gets a unique, randomly generated MAC address for its network interface (QEMU OUI `52:54:00` followed by random bytes).
*   **UUID (Universally Unique Identifier)**: A unique UUID is generated for each VM and assigned as its SMBIOS UUID.
*   **BIOS Serial Number**: A unique BIOS serial number string (e.g., "VMBS0001RNDxxxx") is generated and assigned to each VM.
*   **CPU Model**: `scripts/generate_vm_configs.py` selects a distinct CPU model string for QEMU (e.g., "Nehalem-IBRS", "EPYC-Rome", "Skylake-Client-IBRS") for each VM from a predefined list. This alters the CPU features visible to the guest OS.
*   **RAM Size**: While most VMs are 2048MB, a few are assigned slightly different RAM sizes (e.g., 2000MB, 2096MB) by `scripts/generate_vm_configs.py` to further differentiate them.

These variations help in scenarios where distinguishing VMs from each other, or from a common template, is important.

## 11. Resource Management

*   **CPU**:
    *   Each VM is configured with 1 CPU core (`-smp 1`).
    *   The `cpulimit` utility is used to limit the QEMU process for each VM to use approximately 80% of a single host CPU core's time (`-l 80`). This helps prevent any single VM from monopolizing host CPU resources and allows for running multiple VMs more smoothly on a shared host.
*   **RAM**:
    *   Each VM is allocated 2048MB (2GB) of RAM by default.
    *   As mentioned under Fingerprinting, some VMs receive slightly varied RAM amounts (e.g., 2000MB, 2096MB, 2144MB) for differentiation. These values are defined in `scripts/generate_vm_configs.py`.

## 12. Tools Used

This project utilizes several external commands and tools:

*   **`qemu-system-x86_64`**: The QEMU PC system emulator, used to run the VMs.
*   **`qemu-img`**: QEMU disk image utility, used to create the `.qcow2` disk images.
*   **`python3`**: Used to execute the `scripts/generate_vm_configs.py` script and the temporary HTTP server (`python3 -m http.server`).
*   **`jq`**: Command-line JSON processor, used in `manage_vms.sh` to parse the VM configuration JSON files.
*   **`cpulimit`**: Utility to limit the CPU usage of a process, applied to each QEMU VM process.
*   **`mkpasswd`**: (Referenced for user) Utility to create crypted passwords, useful if changing the default user password in `preseed.cfg`.
*   **Standard Shell Utilities (in `manage_vms.sh`, `setup_vm_in_guest.sh`)**:
    *   `bash`: The interpreter for the main scripts.
    *   `cd`, `mkdir`, `rm`, `cp`, `mv`: Basic file and directory operations.
    *   `cat`, `echo`: For creating files (here-documents) and printing messages.
    *   `chmod`: To set file permissions.
    *   `ps`: To check process status (e.g., for the HTTP server or QEMU PID).
    *   `kill`: To stop the temporary HTTP server.
    *   `wait`: To wait for background processes.
    *   `sleep`: To introduce delays where necessary.
    *   `sed`: Stream editor, used in `preseed.cfg`'s `late_command` to parse kernel command line arguments and in `setup_vm_in_guest.sh` for minor text replacement.
    *   `grep`: (Not directly in current scripts but useful for debugging) Pattern searching.
    *   `tee`: Used in `setup_vm_in_guest.sh` to redirect output to both console and log file.
*   **Inside Guest OS (installed by preseed or `setup_vm_in_guest.sh`)**:
    *   `wget`: To download files (OpenVPN configs, Telegram, parameter scripts).
    *   `apt-get`: Ubuntu package manager.
    *   `systemctl`: To manage systemd services (OpenVPN).
    *   `x11vnc`: The VNC server.
    *   `openvpn`: The OpenVPN client.
    *   `tar`: To extract Telegram.
    *   `ping`: To test OpenVPN connectivity.
    *   `update-desktop-database`: To register Telegram's `.desktop` file.
    *   Various core Linux utilities.

## 13. Customization

*   **Number of VMs**:
    1.  Modify `NUM_VMS` variable at the top of `manage_vms.sh`.
    2.  Modify `NUM_VMS` variable in `scripts/generate_vm_configs.py`.
    3.  Ensure you have a corresponding number of VPN configuration files (e.g., `vpn-1.ovpn` to `vpn-N.ovpn`) in the `vpn/` directory.
*   **VM Resources (RAM, CPU Model, Disk Size, etc.)**:
    *   These are primarily controlled by `scripts/generate_vm_configs.py`. Modify the logic within this Python script to change defaults or how variations are applied. For example, the `CPU_MODELS` list, `ram_mb` logic, or `disk_size_gb`.
*   **Default Ubuntu User/Password (in Guest)**:
    *   Edit `scripts/preseed.cfg`.
    *   Locate `passwd/username` (default `vmuser`).
    *   Locate `passwd/user-password-crypted` (default for `userpass`). To generate a new crypted password, use: `mkpasswd -m sha-512 yournewpassword` and replace the existing hash.
*   **Installed Packages**:
    *   To add more packages during preseed installation: Modify `d-i pkgsel/include string ...` in `scripts/preseed.cfg`.
    *   To install packages after basic OS setup: Add `apt-get install -y <package_name>` commands to `scripts/setup_vm_in_guest.sh`.
*   **Host IP for Guest Access (during install)**:
    *   If QEMU's user-mode network gateway (`10.0.2.2`) is different in your environment, update `HOST_IP_FOR_GUEST` in `manage_vms.sh`.
*   **VNC Ports**:
    *   The base VNC port (5900 for the first VM) is hardcoded in `scripts/generate_vm_configs.py` (`vnc_port_host = 5900 + (vm_id - 1)`).
    *   The QEMU monitor and QMP ports in `manage_vms.sh` are derived from this. Adjust if needed, ensuring no port conflicts on your host.

## 14. Known Limitations / Future Considerations

*   **Sequential VM Creation**: `manage_vms.sh` processes and installs VMs one by one. Parallelizing installations could speed up deployment but would significantly increase complexity and concurrent resource demand.
*   **Error Recovery**: While `manage_vms.sh` has improved error handling, if it's interrupted mid-installation for a VM, manual cleanup of that VM's disk image, PID file, and temporary HTTP server files might be necessary before retrying for that specific VM.
*   **OpenVPN `auth-user-pass`**: The current scripts do not explicitly handle OpenVPN configurations requiring `auth-user-pass` files for credentials. This would need customization in `setup_vm_in_guest.sh`.
*   **`cpulimit` vs Cgroups**: `cpulimit` is simpler to use but cgroups offer more precise and robust CPU (and other resource) control. Implementing cgroup management would be a significant enhancement but adds complexity.
*   **Post-Creation Verification**: The main script primarily verifies that the QEMU process starts. Verifying full guest functionality (OpenVPN connected, Telegram runnable) from the host script is complex and not implemented. Users should manually verify or check guest logs.
*   **Security of Default Passwords**: The default `vmuser`/`userpass` and generated VNC passwords (stored in `vm_info.txt` and VM configs) should be changed if security is a major concern for the deployed VMs.

## 15. License

This project is provided as-is. If you intend to share or distribute it, consider adding an open-source license (e.g., MIT License).

```text
MIT License

Copyright (c) [Year] [Your Name/Organization]

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```
*(Remember to replace `[Year]` and `[Your Name/Organization]` if you use this license.)*

## 16. Contribution

If this were a public project, standard contribution guidelines would apply (e.g., fork, branch, pull request). For now, tailor it to your needs.
